# DynaPork

A dead-simple, containerized, dynamic DNS client targeting [Porkbun.com][1].

## Usage

### Set up your DNS Record

The first step is to set up your DNS record on [Porkbun.com][1], following their ["how to edit DNS Records"][2] knowledge base article.

This client will _not_ create a DNS Record; it will only update an existing Record, i.e. if you intend to manage the `A` record for `vpn.website.ext`,
you _must_ have already set that record up on the Porkbun website. This is due to the nature of the Porkbun API: requests to update a nonexistent DNS Record do nothing while
appearing as if they succeeded. This is subject to change in the future, since the API's third version (the version used by this client)
is under active development.

Be sure, when setting up your domain, that you enable `API Access` on the `Details` dropdown menu for the domain you intend to manage.

### Retrieve your API Keys

This client requires two API keys, an `apikey` and a `secretkey`, both of which are generated by following the instructions on the ["Getting Started with the Porkbun API"][4] knowledge base article.

Note that the secret key will _only_ be displayed immedately following creation. If you do not copy this key and store it in a safe location, you will need to generate new API keys.

The `apikey` will be the key which begins `pk1_...`, and the `secretkey` will be the key which begins `sk1_...`.

Copy both of these keys, as they will be provided as Docker secrets for running the client.

### Set up your Docker-Compose file

While not strictly necessary, the simplest means of operating this client is through the use of a [docker-compose.yml][3] file, an example of which is below:

```docker-compose.yml
version: '3.9'

secrets:
  apikey:
    file: ./secrets/apikey.txt
  secretkey:
    file: ./secrets/secretkey.txt

services:
  dynapork:
    image: hoodnoah/dynapork:latest
    restart: unless-stopped
    secrets:
      - apikey
      - secretkey
    environment:
      - DOMAINNAME=domain.ext # The domain to manage
      - SUBDOMAIN=subdomain   # OPTIONAL: a subdomain, e.g. use "vpn" (without quotes) to manage vpn.domain.ext
      - RECORDTYPE=A          # The record type to maintain, e.g. A, MX, CNAME, etc. Most likely will be an A record.
      - INTERVAL=300000       # The time between checks for a changed IP in milliseconds (there is an enforced minimum of 5 seconds,
                              # or 5000 milliseconds to prevent rate-limiting)
```

This client enforces the use of [Docker Secrets][5] to manage the API keys. This is done to make it more explicit that these keys are _not_ to be checked into version control,
and are to be protected to prevent unauthorized use.

Save the `apikey` and `secretkey` values into files named `apikey.txt` and `secretkey.txt`, respectively, where the files contain nothing but the key value. Ensure if you're using version control that these two files are included in your `.gitignore` file to prevent their exposure.

In the example `docker-compose.yml` file above, note the `secrets:` top-level entry. It directs docker to the files `apikey.txt` and `secretkey.txt`, each under a directory of your own creation (in this case, `secrets`.)

Next, you must set the `DOMAINNAME` environment variable to point to the domain (excluding any optional subdomains) you intend to manage. For example, if you were trying to
maintain the DNS Record for `vpn.dynapork.net`, you would put `dynapork.net`.

Then set the `SUBDOMAIN` environment variable if you wish to maintain a subdomain. If you don't, simply leave this line out.

Then set the `RECORDTYPE` environment variable to the type of record you wish to maintain. In most cases, this will be an `A` record.

Finally, set the `INTERVAL` environment variable. This sets the frequency (in milliseconds) with which `DynaPork` checks to see if your IP Address has changed. There is an enforced minimum interval of 5 seconds to prevent flooding the API with requests and getting blocked/rate-limited. If not provided, `DynaPork` defaults to 15 minutes.
Note that `INTERVAL` sets the effective maximum downtime of services you're trying to reach at this DNS Record.

Note also that the `restart: unless-stopped` value ensures this compose file will be automatically restarted when the `Docker` daemon on your system starts, thereby
invalidating the need to mess with system configurations to periodically run the client.

### Run the Client

Once you've created your `docker-compose.yml` file, simply run `docker compose up -d` in the same directory containing your compose file.

## Troubleshooting

When running `DynaPork`, a number of logs may be printed (inspect them by running `docker container logs <HASH>`, where `<HASH>` is the id of the container running `DynaPork`.)

Each log message will have a severity printed alongside it, ranging from `INFO` to `WARNING` to `ERROR`.

`INFO` messages are just that: information. These are there simply for the end-users' sake, to demonstrate that the program is running.

`WARNING` messages are messages indicating something hasn't worked correctly, but not to the level that the client will fail.

`ERROR` messages indicate something is configured incorrectly with the client, or the client is not operating correctly.

There are a few common pitfalls when getting this client running correctly.

First, if a non-optional environment variable has not been set (e.g. `DOMAINNAME`, `RECORDTYPE`) or either/both of the API Keys haven't been set, the client will fail to start
and will print an error indicating which environment variable has been misconfigured.

[1]: https://porkbun.com/
[2]: https://kb.porkbun.com/article/68-how-to-edit-dns-records
[3]: https://docs.docker.com/compose/compose-file/compose-file-v3/
[4]: https://kb.porkbun.com/article/190-getting-started-with-the-porkbun-api
[5]: https://docs.docker.com/engine/swarm/secrets/
